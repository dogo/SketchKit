name: Testing
on: [push, pull_request]

jobs:
  test:
    name: Testing SketchKit
    runs-on: macos-11
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2.3.4
      
      - name: Setup Xcode version
        uses: maxim-lobanov/setup-xcode@v1.4.0
        with:
          xcode-version: 13.0

      - name: Set up Ruby 2.7.2
        uses: ruby/setup-ruby@v1.84.0
        with:
          ruby-version: 2.7.2
          bundler-cache: true

      - name: Danger action
        uses: MeilCli/danger-action@v5.4.11
        with:
          plugins_file: 'Gemfile'
          install_path: 'vendor/bundle'
          danger_file: 'Dangerfile'
          danger_id: 'danger-pr'
        env:
          DANGER_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}          
      
      - name: Running SketchKit Unit Tests
        run: exec ./.github/scripts/test_app.sh
        shell: bash
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v2.1.0
